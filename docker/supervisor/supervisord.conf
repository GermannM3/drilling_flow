[supervisord]
nodaemon=true
logfile=/app/logs/supervisord.log
logfile_maxbytes=50MB
logfile_backups=10
loglevel=info

[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"
autostart=true
autorestart=true
priority=5

[program:uvicorn]
command=uvicorn app.main:app --host 0.0.0.0 --port 8080 --workers 4 --limit-max-requests 10000 --backlog 2048 --timeout 120
autorestart=true
stdout_logfile=/app/logs/uvicorn.log
stderr_logfile=/app/logs/uvicorn_err.log
startsecs=5
stopwaitsecs=30
killasgroup=true
priority=10

[program:telegram_bot]
command=python -OO app/bot/main.py
autorestart=true
stdout_logfile=/app/logs/telegram_bot.log
stderr_logfile=/app/logs/telegram_bot_err.log
startsecs=5
stopwaitsecs=30
killasgroup=true
priority=20

[program:celery]
command=celery -A app.worker worker --loglevel=info --concurrency=4
autorestart=true
stdout_logfile=/app/logs/celery.log
stderr_logfile=/app/logs/celery_err.log
priority=30

[program:celery_beat]
command=celery -A app.worker beat --loglevel=info
autorestart=true
stdout_logfile=/app/logs/celery_beat.log
stderr_logfile=/app/logs/celery_beat_err.log
priority=40

[group:drillflow]
programs=nginx,uvicorn,telegram_bot,celery,celery_beat
priority=999 